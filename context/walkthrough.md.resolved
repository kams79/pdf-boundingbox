# PDF Bounding Box â€” OCR Viewer Walkthrough

## What Was Built

A React + TypeScript + Vite PDF viewer with OCR, auto-detection of digitized PDFs, and a field annotation system.

---

## Features Verified âœ…

| Feature | Status |
|---|---|
| PDF opens and renders pages | âœ… Done |
| Bounding boxes align with visible text | âœ… Done |
| OCR bounding box overlay fix (DPR + container sizing) | âœ… Done |
| Auto-detect pre-digitized PDFs (no OCR needed) | âœ… Done |
| Field annotation â€” click words to select | âœ… Done |
| Field annotation â€” Shift+click multi-select | âœ… Done |
| Field annotation â€” free-draw rectangle | âœ… Done |
| Drawn rectangle captures only characters inside box | âœ… Done |
| Fields tab in sidebar with rename/delete | âœ… Done |
| Export searchable PDF | âœ… Done |

---

## Architecture

```
src/
  components/
    PDFViewer.tsx          â€” react-pdf wrapper, exposes page proxy + canvas
    BoundingBoxOverlay.tsx â€” word boxes, selection, draw-rect, field UI
    Toolbar.tsx            â€” ğŸ· Field mode button, OCR, zoom, open, export
    Sidebar.tsx            â€” OCR Text / Words / Fields / Markup tabs
  services/
    ocrService.ts          â€” Tesseract.js browser OCR
    pdfTextExtractor.ts    â€” pdf.js getTextContent() for pre-digitized PDFs
    fieldStore.ts          â€” Zustand store for FieldAnnotations
    annotationStore.ts     â€” Zustand store for draw/highlight markup
    pdfExport.ts           â€” pdf-lib PDF export with embedded text
  utils/
    textCapture.ts         â€” Character-level text extraction within a bbox
  types/index.ts           â€” All shared interfaces
```

## Key Design Decisions

- **Normalized [0â€“1] bboxes** â€” all OCR and embedded-text coordinates are normalized to the page fraction, making overlays zoom-invariant and DPR-independent.
- **page-container explicit sizing** â€” the container is explicitly sized to `canvas.offsetWidth Ã— canvas.offsetHeight` so all absolute overlay layers align perfectly.
- **Two field creation flows**: click-select words â†’ label, or drag-draw a rectangle â†’ label (captures characters strictly inside via center-point + proportional slicing).
- **CDN worker** â€” `pdfjs-dist` worker loaded from `unpkg.com` at the exact version bundled by `react-pdf` to avoid version mismatches.
